<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Map Builder</title>
	<link rel="stylesheet" href="builder.css">
</head>
<body>
<div id="app">
	<!-- Loading Overlay -->
	<div id="loading-overlay">
		<div class="spinner"></div>
		<div id="loading-text">Generating Thumbnails...</div>
	</div>

	<!-- Top Menu Bar -->
	<div id="top-bar">
		<div class="menu-group">
			<button id="btnSave" class="info">Save</button>
			<button id="btnSaveAs" class="secondary">Save As...</button>
			<button id="btnLoad" class="secondary">Load</button>
			<input type="file" id="fileInput" accept=".json">
		</div>

		<div class="menu-group">
			<button id="btnUndo" class="secondary" disabled title="Undo (Ctrl+Z)">â†¶ Undo</button>
			<button id="btnRedo" class="secondary" disabled title="Redo (Ctrl+Y)">â†· Redo</button>
		</div>

		<!-- Gizmo Controls -->
		<div class="menu-group">
			<button id="btnGizmoPos" class="active" title="Move (G)">Move</button>
			<button id="btnGizmoRot" title="Rotate (R)">Rotate</button>
			<button id="btnGizmoScale" title="Scale (S)">Scale</button>
		</div>

		<!-- Nudge Controls -->
		<div class="menu-group">
			<span style="color: #bdc3c7; font-size: 12px; margin-right: 5px;">Step:</span>
			<input type="number" id="inputCursorStep" value="0.005" step="0.005" min="0.001"
				   style="width: 75px; text-align: center; padding: 2px; border: 1px solid #34495e; background: #233342; color: white; border-radius: 3px;"
				   title="Arrow Key Increment">
		</div>

		<!-- Object Actions -->
		<div class="menu-group">
			<button id="btnDuplicate" disabled title="Duplicate Selected">Duplicate</button>
			<button id="btnDeleteObj" class="danger" disabled title="Delete Selected">Delete</button>
		</div>

		<div class="menu-group">
			<!-- Light Dropdown -->
			<div class="dropdown">
				<button id="btnAddLightMenu" title="Add Light">ðŸ’¡ Add Light â–¼</button>
				<div class="dropdown-content">
					<a id="btnAddPointLight">Point Light</a>
					<a id="btnAddDirLight">Directional Light</a>
					<a id="btnAddHemiLight">Hemispheric Light</a>
				</div>
			</div>

			<button id="btnClearSelection" class="secondary" title="Clear Asset/Object Selection (Esc)">Clear Selection
			</button>
			<button id="btnResetCam" class="secondary">Reset Camera</button>
			<button id="btnClearScene" class="danger">Clear Scene</button>
		</div>

		<div class="menu-group" style="border-right: none; margin-left: auto;">
			<button id="btnSettings" class="info">âš™ Settings</button>
		</div>
	</div>

	<!-- Main Content -->
	<div id="main-content">
		<!-- Left Sidebar: Assets -->
		<div id="left-sidebar">
			<div id="left-sidebar-header">
				<span>Assets</span>
				<span id="sidebar-toggle-icon">â–¼</span>
			</div>

			<!-- NEW: Asset Store Panel -->
			<div class="sidebar-section-header">Asset Store</div>
			<div id="asset-store-list" class="sidebar-scroll-area">
				<div class="empty-state">No assets in store.<br>Add from File Browser below.</div>
			</div>

			<!-- Existing: File Browser -->
			<div class="sidebar-section-header" style="border-top: 2px solid #1a252f;">File Browser</div>
			<div style="padding: 5px 10px; background: #233342; border-bottom: 1px solid #1a252f;">
				<select id="asset-folder-select"
						style="width: 100%; padding: 4px; background: #34495e; color: white; border: 1px solid #46607a; border-radius: 3px;">
					<option value="" disabled selected>Select Folder...</option>
				</select>
			</div>

			<div id="asset-list" class="sidebar-scroll-area">
				<div id="asset-load-area">
					<p style="color: #bdc3c7; font-size: 13px; margin-bottom: 15px;">Select a folder to load.</p>
					<button id="btnLoadAssets" class="info" disabled>Load Files</button>
				</div>
			</div>
		</div>

		<!-- Canvas -->
		<canvas id="renderCanvas"></canvas>

		<!-- Right Sidebar: Properties + Tree View -->
		<div id="right-sidebar">
			<!-- Properties Panel -->
			<div id="properties-panel">

				<!-- Lock Toggle -->
				<div class="prop-group">
					<div class="prop-row" style="justify-content: flex-start;">
						<input type="checkbox" id="chkLock" style="width: auto; margin-right: 8px;">
						<label for="chkLock" style="margin: 0; cursor: pointer; color: white;">Lock Object(s)</label>
					</div>
				</div>

				<!-- Shared Properties -->
				<div id="shared-props">
					<!-- Single Object Specifics (Name + Color + Reset) -->
					<div id="single-obj-props">
						<div class="prop-group">
							<div class="name-color-row">
								<input type="text" id="propName" placeholder="Object Name" title="Object Name">
							</div>
						</div>
					</div>

					<div class="prop-group">
						<div class="prop-row compact">
							<div class="input-col"><span>Pos: X</span><input type="number" id="posX" step="0.1"></div>
							<div class="input-col"><span>Y</span><input type="number" id="posY" step="0.1"></div>
							<div class="input-col"><span>Z</span><input type="number" id="posZ" step="0.1"></div>
						</div>
					</div>

					<div class="prop-group">
						<div class="prop-row compact">
							<div class="input-col"><span>Rot: X</span><input type="number" id="rotX" step="15"></div>
							<div class="input-col"><span>Y</span><input type="number" id="rotY" step="15"></div>
							<div class="input-col"><span>Z</span><input type="number" id="rotZ" step="15"></div>
						</div>
					</div>

					<div class="prop-group">
						<div class="prop-row compact">
							<div class="input-col"><span>Scale: X</span><input type="number" id="scaleX" step="0.1"></div>
							<div class="input-col"><span>Y</span><input type="number" id="scaleY" step="0.1"></div>
							<div class="input-col"><span>Z</span><input type="number" id="scaleZ" step="0.1"></div>
						</div>
					</div>
				</div>

				<!-- Light Properties (New Section) -->
				<div id="light-props" style="display: none; border-top: 1px solid #34495e; margin-top: 5px; padding-top: 5px;">
					<label style="color: #f1c40f; font-weight: bold; margin-bottom: 5px; display: block;">Light Properties</label>

					<div class="prop-group">
						<div class="control-row">
							<span>Intensity:</span>
							<input type="number" id="propIntensity" step="0.1" min="0">
						</div>
					</div>

					<!-- Light Colors -->
					<div class="prop-group">
						<div class="control-row">
							<span>Diffuse:</span>
							<input type="color" id="propLightDiffuse" title="Diffuse Color">
						</div>
						<div class="control-row" style="margin-top:4px;">
							<span>Specular:</span>
							<input type="color" id="propLightSpecular" title="Specular Color">
						</div>
						<div class="control-row" id="rowGroundColor" style="margin-top:4px; display:none;">
							<span>Ground:</span>
							<input type="color" id="propLightGround" title="Ground Color (Hemispheric)">
						</div>
					</div>

					<div class="prop-group">
						<div class="control-row" style="justify-content: flex-start;">
							<input type="checkbox" id="propCastShadows" style="width: auto; margin-right: 8px;">
							<label for="propCastShadows" style="margin: 0; cursor: pointer; color: white;">Cast Shadows</label>
						</div>
					</div>

					<div id="light-direction-props" style="display: none;">
						<div class="prop-group">
							<label>Direction (Vector)</label>
							<div class="prop-row compact">
								<div class="input-col"><span>X</span><input type="number" id="lightDirX" step="0.1"></div>
								<div class="input-col"><span>Y</span><input type="number" id="lightDirY" step="0.1"></div>
								<div class="input-col"><span>Z</span><input type="number" id="lightDirZ" step="0.1"></div>
							</div>
						</div>
					</div>
				</div>

				<!-- Multi Object View -->
				<div id="multi-obj-props" style="display: none;">

					<div class="prop-group">
						<label>Alignment</label>
						<!-- X Axis -->
						<div class="align-grid">
							<span>X</span>
							<button id="btnAlignXMin" class="btn-axis-x" title="Align Left">Min</button>
							<button id="btnAlignXCenter" class="btn-axis-x" title="Align Center X">Mid</button>
							<button id="btnAlignXMax" class="btn-axis-x" title="Align Right">Max</button>
						</div>
						<!-- Y Axis -->
						<div class="align-grid">
							<span>Y</span>
							<button id="btnAlignYMin" class="btn-axis-y" title="Align Bottom">Bot</button>
							<button id="btnAlignYCenter" class="btn-axis-y" title="Align Center Y">Mid</button>
							<button id="btnAlignYMax" class="btn-axis-y" title="Align Top">Top</button>
						</div>
						<!-- Z Axis -->
						<div class="align-grid">
							<span>Z</span>
							<button id="btnAlignZMin" class="btn-axis-z" title="Align Back">Min</button>
							<button id="btnAlignZCenter" class="btn-axis-z" title="Align Center Z">Mid</button>
							<button id="btnAlignZMax" class="btn-axis-z" title="Align Front">Max</button>
						</div>
					</div>

					<!-- Spacing Group -->
					<div class="prop-group">
						<label>Space Side-by-Side</label>
						<!-- Margin Input -->
						<div class="control-row" style="margin-bottom: 5px;">
							<span style="font-size: 11px; color: #bdc3c7;">Margin:</span>
							<input type="number" id="inputSnapMargin" value="0" step="0.1" style="width: 60px; padding: 2px; text-align: center;">
						</div>
						<div class="control-row">
							<button id="btnSnapX" class="btn-axis-x" title="Snap objects together on X axis">Snap X</button>
							<button id="btnSnapY" class="btn-axis-y" title="Snap objects together on Y axis">Snap Y</button>
							<button id="btnSnapZ" class="btn-axis-z" title="Snap objects together on Z axis">Snap Z</button>
						</div>
					</div>

					<!-- Grouping Control -->
					<div class="prop-group">
						<label>Grouping</label>
						<button id="btnCreateGroup" class="info" style="width: 100%;">Group Selected</button>
					</div>

					<div class="prop-group">
						<label>Selected Objects</label>
						<div id="multi-select-container"></div>
					</div>
				</div>
			</div>

			<div id="sidebar-splitter"></div>

			<!-- Tree View -->
			<div id="tree-view">
				<div id="tree-header">
					<span>Scene Objects</span>
					<span id="tree-toggle-icon">â–¼</span>
				</div>
				<div id="tree-content"></div>
			</div>
		</div>
	</div>

	<!-- Bottom Status Bar -->
	<div id="status-bar">
		<div id="status-left">Ready</div>
		<div id="status-coords">0.00, 0.00, 0.00</div>
		<!-- Stats Display -->
		<div id="status-stats" style="margin-right: 20px; color: #95a5a6; font-family: monospace;">Meshes: 0 | Poly: 0</div>
		<div id="auto-save-container">
			<span id="auto-save-text">Not saved yet.</span>
			<a href="#" id="btnSaveNow" style="color: #3498db; text-decoration: none; margin-left: 5px;">Save Now</a>
		</div>
	</div>

	<!-- Modals (Settings, Grid, Save) -->
	<div id="settingsModal" class="modal-overlay">
		<div class="modal-content">
			<div class="modal-header">Global Settings</div>
			<div class="control-group" style="border-bottom: 1px solid #34495e; padding-bottom: 10px; margin-bottom: 10px;">
				<label style="color: #f1c40f;">Input Precision (Steps)</label>
				<div class="control-row">
					<span>Pos Step:</span>
					<input type="number" id="settingPosStep" step="0.0001" min="0.0001" value="0.1">
				</div>
				<div class="control-row">
					<span>Rot Step:</span>
					<input type="number" id="settingRotStep" step="0.0001" min="0.0001" value="15">
				</div>
				<div class="control-row">
					<span>Scale Step:</span>
					<input type="number" id="settingScaleStep" step="0.0001" min="0.0001" value="0.1">
				</div>
				<div class="control-row">
					<span>Cursor Step:</span>
					<input type="number" id="settingCursorStep" step="0.0001" min="0.0001" value="0.05">
				</div>
			</div>
			<div class="control-group">
				<div class="control-row">
					<label>New Object Y-Offset:</label>
					<input type="number" id="settingYOffset" step="0.1" value="0">
				</div>
			</div>
			<div class="control-group">
				<div class="control-row">
					<label>Grid Cell Size:</label>
					<input type="number" id="settingGridSize" step="0.5" min="0.5" value="2.5">
				</div>
			</div>
			<div class="control-group">
				<div class="control-row">
					<label>Grid Line Color:</label>
					<input type="color" id="settingGridColor" value="#555555">
				</div>
			</div>
			<div class="control-group">
				<div class="control-row">
					<label>Canvas Background Color:</label>
					<input type="color" id="settingBgColor" value="#2c3e50">
				</div>
			</div>
			<div class="control-group" style="margin-top: 10px; border-top: 1px solid #34495e; padding-top: 10px;">
				<div class="control-row">
					<label><input type="checkbox" id="settingAutoSave" checked> Auto-Save Map (LocalStorage)</label>
				</div>
			</div>
			<div class="modal-footer">
				<button id="btnCancelSettings" class="secondary">Cancel</button>
				<button id="btnSaveSettings">Save & Apply</button>
			</div>
		</div>
	</div>

	<div id="gridModal" class="modal-overlay">
		<div class="modal-content">
			<div class="modal-header">Add Object Grid</div>
			<div class="control-group">
				<label>Rows:</label>
				<input type="number" id="gridRows" value="3" min="1">
			</div>
			<div class="control-group">
				<label>Columns:</label>
				<input type="number" id="gridCols" value="3" min="1">
			</div>
			<div class="modal-footer">
				<button id="btnCancelGrid" class="secondary">Cancel</button>
				<button id="btnCreateGrid">Create Grid</button>
			</div>
		</div>
	</div>

	<div id="saveMapModal" class="modal-overlay">
		<div class="modal-content">
			<div class="modal-header">Save Map</div>
			<div class="control-group">
				<label>Map Name:</label>
				<input type="text" id="saveMapName" value="new_map">
			</div>
			<div class="modal-footer">
				<button id="btnCancelSave" class="secondary">Cancel</button>
				<button id="btnConfirmSave">Save</button>
			</div>
		</div>
	</div>

	<!-- Add Asset Modal -->
	<div id="addAssetModal" class="modal-overlay">
		<div class="modal-content">
			<div class="modal-header">Add to Asset Store</div>
			<div class="control-group">
				<label>Asset Name (Unique ID):</label>
				<input type="text" id="inputAssetName" placeholder="e.g. Rock_Large">
			</div>
			<div class="modal-footer">
				<button id="btnCancelAddAsset" class="secondary">Cancel</button>
				<button id="btnConfirmAddAsset">Add to Store</button>
			</div>
		</div>
	</div>

	<!-- Custom Context Menu -->
	<div id="context-menu">
		<!-- Store Items -->
		<div class="ctx-item store-only" id="ctx-add-grid-store">Add Grid of Objects...</div>

		<!-- Browser Items -->
		<div class="ctx-item browser-only" id="ctx-add-to-store">Add to Asset Store...</div>

		<!-- Scene Items -->
		<div class="ctx-item scene-only" id="ctx-set-anchor">Set Anchor</div>
		<div class="ctx-item scene-only" id="ctx-release-anchor">Release Anchor</div>
		<div class="ctx-item scene-only" id="ctx-delete-asset" style="border-top: 1px solid #34495e; color: #e74c3c;">Delete
			Asset
		</div>
	</div>
</div>
</body>
</html>